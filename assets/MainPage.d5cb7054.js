import{X as l,L as p,a as A,E as C,_ as O,o as w,c as _,b as i,d as B,e as k,u as V,r as g,f as I,t as E,w as x,v as $,g as T,h as j}from"./index.2e4e6f02.js";class N{static call(e){return new Promise(s=>{const a=e.data(),r=l.shared().config.serializer.decodeFunctionName(a);if(!r)return p.e("[LocalClient : call] Function name is empty"),s(void 0);const m=A.shared().find(r);if(m==null)return p.e("[LocalClient : call] Mapping not found for function: "+r),s(void 0);let h;try{h=l.shared().config.serializer.decodeMessage(a)}catch(u){p.e("[LocalClient : call] Error when decode message: "+C.get(u))}if(!h)return p.e("[LocalClient : call] Error when decode message for function: "+r),s(void 0);try{return s(m.target(h))}catch(u){p.e("[LocalClient : call] Error: "+C.get(u))}return s(void 0)})}}class P{constructor(){this._isAcquired=!1,this._acquiredMap=new Map,this.waitingMap=new Map,this.waitingList=[]}acquire(e){if(e){if(!this._acquiredMap.has(e)||!this._acquiredMap.get(e))return this._acquiredMap.set(e,!0),Promise.resolve()}else if(!this._isAcquired)return this._isAcquired=!0,Promise.resolve();return new Promise(s=>{if(e)if(this.waitingMap.has(e)){const a=this.waitingMap.get(e);a&&(a.push(s),this.waitingMap.set(e,a))}else this.waitingMap.set(e,[s]);else this.waitingList.push(s)})}isAcquired(e){return e?this._acquiredMap.has(e)?this._acquiredMap.get(e):!1:this._isAcquired}release(e){if(e){if(!this._acquiredMap.has(e)||!this._acquiredMap.get(e))throw new Error("Please acquire a lock for "+e+" before releasing!!");{const s=this.waitingMap.get(e);if(s&&s.length>0){const a=this.waitingMap.get(e)?.shift();a&&a()}else this.waitingMap.has(e)&&this.waitingMap.delete(e),this._acquiredMap.set(e,!1)}}else if(this._isAcquired)if(this.waitingList.length>0){const s=this.waitingList.shift();s&&s()}else this._isAcquired=!1;else throw new Error("Please acquire a lock before releasing!!")}}class f{constructor(){this.list=new Map,this.lock=new P}static shared(){return f.instance||(f.instance=new f),f.instance}async add(e,s){return await this.lock.acquire(),this.list.set(e,s),this.lock.release()}async execute(e,s){if(await this.lock.acquire(),this.list.has(e)){const a=this.list.get(e);return this.list.delete(e),this.lock.release(),a?.(s)}return this.lock.release()}async count(){await this.lock.acquire();const e=this.list.size;return this.lock.release(),e}}class d{constructor(){this.lock=new P,this.uid=0}static shared(){return d.instance||(d.instance=new d),d.instance}static async generate(){await d.shared().lock.acquire();const e=(++d.shared().uid).toString();return d.shared().lock.release(),e}}class q{static call(e){return new Promise(s=>{if(!l.shared().initialized)return p.e("[XRemoteClient : call] The WASM module is not initialized"),s(void 0);try{d.generate().then(a=>{f.shared().add(a,r=>s(l.shared().config.serializer.decodeFunctionReturnValue(r))),l.shared().module.ProxyClient.callFromJavascript(e.data(),r=>{f.shared().execute(a,r)})})}catch(a){return p.e("[XRemoteClient : call] Error: "+C.get(a)),s(void 0)}})}}class v{constructor(e,s){this.name=e,this.value=s}}class R{constructor(e,...s){this.functionName=e,this.params=s}data(){return l.shared().config.serializer.encodeRequest(this.functionName,...this.params)}}var z={name:"VueCamera",props:{width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:500},autoplay:{type:Boolean,default:!0},screenshotFormat:{type:String,default:"image/jpeg"},selectFirstDevice:{type:Boolean,default:!0},playsinline:{type:Boolean,default:!0},resolution:{type:Object,default:null,validator:t=>t.height&&t.width}},emits:["xplpc-camera-list","xplpc-camera-not-supported","xplpc-camera-changed","xplpc-camera-stopped","xplpc-camera-video-live","xplpc-camera-started","xplpc-camera-error"],data(){return{source:null,canvas:null,camerasListEmitted:!1,cameraList:[],deviceId:"",visible:!1,ctx:null}},watch:{deviceId:function(t){this.changeCamera(t)}},beforeUnmount(){this.stop()},methods:{legacyGetUserMediaSupport(){return t=>{let e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;return e?new Promise(function(s,a){e.call(navigator,t,s,a)}):Promise.reject(new Error("[Camera : legacyGetUserMediaSupport] The method getUserMedia is not implemented in this browser"))}},setupMedia(){navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=this.legacyGetUserMediaSupport()),this.testMediaAccess()},loadCameraList(){navigator.mediaDevices.enumerateDevices().then(t=>{for(let e=0;e!==t.length;++e){let s=t[e];s.kind==="videoinput"&&this.cameraList.push(s)}}).then(()=>{this.camerasListEmitted||(this.selectFirstDevice&&this.cameraList.length>0&&this.setDeviceId(this.cameraList[0].deviceId),this.$emit("xplpc-camera-list",this.cameraList),this.camerasListEmitted=!0)}).catch(t=>this.$emit("xplpc-camera-not-supported",t))},changeCamera(t){this.stop(),this.$emit("xplpc-camera-changed",t),this.loadCamera(t)},loadSrcStream(t){"srcObject"in this.$refs.video?this.$refs.video.srcObject=t:this.source=window.HTMLMediaElement.srcObject(t),this.$refs.video.onloadedmetadata=()=>{this.$emit("xplpc-camera-video-live",t)},this.$emit("xplpc-camera-started",t)},stopStreamedVideo(t){let e=t.srcObject;e.getTracks().forEach(a=>{a.stop(),this.$emit("xplpc-camera-stopped",e),this.$refs.video.srcObject=null,this.source=null})},stop(){this.$refs.video&&this.$refs.video.srcObject&&this.stopStreamedVideo(this.$refs.video)},start(){this.deviceId||this.loadCameraList(),this.deviceId&&(this.setupMedia(),this.loadCamera(this.deviceId))},pause(){this.$refs.video&&this.$refs.video.srcObject&&this.$refs.video.pause()},resume(){this.$refs.video&&this.$refs.video.srcObject&&this.$refs.video.play()},processImage(){setInterval(async()=>{this.getCanvas();const t=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);var e=t.data.length,s=new Uint8Array(t.data),a=l.shared().module._malloc(e);l.shared().module.HEAPU8.set(s,a);const r=new R("sample.image.grayscale.pointer",new v("pointer",a),new v("width",this.canvas.width),new v("height",this.canvas.height));await q.call(r);var m=new Uint8ClampedArray(l.shared().module.HEAPU8.buffer,a,e);this.ctx.putImageData(new ImageData(m,this.canvas.width,this.canvas.height),0,0);const h=this.$refs.preview;h.src=this.canvas.toDataURL(),l.shared().module._free(a)},16)},testMediaAccess(){let t={video:!0};this.resolution&&(t.video={},t.video.height=this.resolution.height,t.video.width=this.resolution.width),navigator.mediaDevices.getUserMedia(t).then(e=>{e.getTracks().forEach(a=>{a.stop()}),this.loadCameraList()}).catch(e=>this.$emit("xplpc-camera-error",e))},loadCamera(t){let e={video:{deviceId:{exact:t}}};this.resolution&&(e.video.height=this.resolution.height,e.video.width=this.resolution.width),navigator.mediaDevices.getUserMedia(e).then(s=>this.loadSrcStream(s)).catch(s=>this.$emit("xplpc-camera-error",s))},capture(){return this.getCanvas().toDataURL(this.screenshotFormat)},getCanvas(){let t=this.$refs.video;if(!this.ctx){let a=document.createElement("canvas");a.width=t.videoWidth,a.height=t.videoHeight,this.canvas=a,this.ctx=a.getContext("2d",{willReadFrequently:!0})}const{ctx:e,canvas:s}=this;return e.drawImage(t,0,0,s.width,s.height),s},setDeviceId(t){this.deviceId=t},canPlay(){this.getCanvas(),this.processImage(),this.visible=!0}}};const G={class:"text-center"},X={class:"camera-container text-center"},H=["width","height","src","autoplay","playsinline"],W={key:0,ref:"preview",class:"camera-image"};function J(t,e){return w(),_("div",G,[i("div",X,[i("video",{ref:"video",width:t.width,height:t.height,src:t.source,autoplay:t.autoplay,playsinline:t.playsinline,style:{display:"none"},onCanplay:e[0]||(e[0]=(...s)=>t.canPlay&&t.canPlay(...s))},null,40,H),t.visible?(w(),_("img",W,null,512)):B("",!0)])])}var Y=O(z,[["render",J]]);const K={class:"container"},Q={key:0},Z={class:"text-left"},ee=i("h4",{id:"pageTitle",class:"my-5 text-center"},"BATTERY LEVEL",-1),te={class:"my-5 text-center"},se={id:"responseMessageForBattery",class:"text-center"},ae=i("hr",null,null,-1),ie=i("h4",{id:"pageTitle",class:"my-5 text-center"},"LOGIN",-1),re={class:"mb-3"},ne=i("label",{for:"fieldUsername",class:"form-label"},"Username",-1),oe={class:"mb-3"},ce=i("label",{for:"fieldPassword",class:"form-label"},"Password",-1),le={class:"mb-3 form-check"},de=i("label",{class:"form-check-label",for:"fieldRemember"},"Remember",-1),he={class:"my-5 text-center"},ue={id:"responseMessageForForm",class:"text-center"},me=i("button",{type:"submit",class:"btn btn-primary"},"Submit",-1),pe=i("hr",null,null,-1),fe=i("h4",{id:"pageTitle",class:"my-5 text-center"},"CAMERA",-1),ve={class:"mb-5 text-center"},ge={key:1},we=i("div",{class:"text-center"},[i("p",{class:"my-5"},"Loading...")],-1),_e=[we],Me=k({__name:"MainPage",setup(t){const e=V(),s=g(null),a=g(null),r=g(!1),m=g(),h="Use account paulo/123456 to success login",u=g(h),L="Press Button To Execute",b=g(L);async function S(n){n.preventDefault(),M("Calling...");const c=new R("sample.login",new v("username",s.value),new v("password",a.value),new v("remember",r.value));let o=await q.call(c);M(o?"Response: "+o:"Response: ERROR!")}async function U(n){n.preventDefault(),y("Calling...");const c=new R("platform.battery.level",new v("suffix","%"));let o=await N.call(c);y(o?"Response: "+o:"Response: ERROR!")}async function F(n){n.preventDefault(),m.value?.start()}function M(n){n?u.value=n:u.value="ERROR!"}function y(n){n?b.value=n:b.value="ERROR!"}function D(){s.value=null,a.value=null,r.value=!1,u.value=h,b.value=L}return(n,c)=>(w(),_("div",K,[I(e).isLoaded?(w(),_("div",Q,[i("div",Z,[ee,i("p",te,[i("small",se,E(b.value),1)]),i("div",{class:"form-bt-group text-center mb-5"},[i("button",{type:"button",class:"btn btn-primary",onClick:U},"Submit")]),ae,ie,i("form",{onSubmit:S},[i("div",re,[ne,x(i("input",{id:"fieldUsername","onUpdate:modelValue":c[0]||(c[0]=o=>s.value=o),type:"text",class:"form-control"},null,512),[[$,s.value]])]),i("div",oe,[ce,x(i("input",{id:"fieldPassword","onUpdate:modelValue":c[1]||(c[1]=o=>a.value=o),type:"password",class:"form-control"},null,512),[[$,a.value]])]),i("div",le,[x(i("input",{id:"fieldRemember","onUpdate:modelValue":c[2]||(c[2]=o=>r.value=o),type:"checkbox",class:"form-check-input"},null,512),[[T,r.value]]),de]),i("p",he,[i("small",ue,E(u.value),1)]),i("div",{class:"form-bt-group text-center mb-5"},[me,i("button",{type:"button",class:"btn btn-primary",onClick:D},"Clear")])],32),pe,fe,i("div",ve,[j(Y,{ref_key:"camera",ref:m,width:240,height:320},null,512)]),i("div",{class:"form-bt-group text-center mb-5"},[i("button",{type:"button",class:"btn btn-primary",onClick:F},"Open")])])])):(w(),_("div",ge,_e))]))}});export{Me as default};
