import{X as l,L as v,a as fe,E as C,_ as we,o as g,c as f,b as i,d as ee,t as U,e as ye,u as be,r as w,f as Me,w as L,v as te,g as xe,h as Ce,__tla as Ue}from"./index.d1a907e3.js";let ae,Le=Promise.all([(()=>{try{return Ue}catch{}})()]).then(async()=>{class ie{static call(e){return new Promise(t=>{const s=e.data(),r=l.shared().config.serializer.decodeFunctionName(s);if(!r)return v.e("[LocalClient : call] Function name is empty"),t(void 0);const p=fe.shared().find(r);if(p==null)return v.e("[LocalClient : call] Mapping not found for function: "+r),t(void 0);let u;try{u=l.shared().config.serializer.decodeMessage(s)}catch(o){v.e("[LocalClient : call] Error when decode message: "+C.get(o))}if(!u)return v.e("[LocalClient : call] Error when decode message for function: "+r),t(void 0);try{return t(p.target(u))}catch(o){v.e("[LocalClient : call] Error: "+C.get(o))}return t(void 0)})}}class k{constructor(){this._isAcquired=!1,this._acquiredMap=new Map,this.waitingMap=new Map,this.waitingList=[]}acquire(e){if(e){if(!this._acquiredMap.has(e)||!this._acquiredMap.get(e))return this._acquiredMap.set(e,!0),Promise.resolve()}else if(!this._isAcquired)return this._isAcquired=!0,Promise.resolve();return new Promise(t=>{if(e)if(this.waitingMap.has(e)){const s=this.waitingMap.get(e);s&&(s.push(t),this.waitingMap.set(e,s))}else this.waitingMap.set(e,[t]);else this.waitingList.push(t)})}isAcquired(e){return e?this._acquiredMap.has(e)?this._acquiredMap.get(e):!1:this._isAcquired}release(e){if(e){if(!this._acquiredMap.has(e)||!this._acquiredMap.get(e))throw new Error("Please acquire a lock for "+e+" before releasing!!");{const t=this.waitingMap.get(e);if(t&&t.length>0){const s=this.waitingMap.get(e)?.shift();s&&s()}else this.waitingMap.has(e)&&this.waitingMap.delete(e),this._acquiredMap.set(e,!1)}}else if(this._isAcquired)if(this.waitingList.length>0){const t=this.waitingList.shift();t&&t()}else this._isAcquired=!1;else throw new Error("Please acquire a lock before releasing!!")}}class m{constructor(){this.list=new Map,this.lock=new k}static shared(){return m.instance||(m.instance=new m),m.instance}async add(e,t){return await this.lock.acquire(),this.list.set(e,t),this.lock.release()}async execute(e,t){if(await this.lock.acquire(),this.list.has(e)){const s=this.list.get(e);return this.list.delete(e),this.lock.release(),s?.(t)}return this.lock.release()}async count(){await this.lock.acquire();const e=this.list.size;return this.lock.release(),e}}class h{constructor(){this.lock=new k,this.uid=0}static shared(){return h.instance||(h.instance=new h),h.instance}static async generate(){await h.shared().lock.acquire();const e=(++h.shared().uid).toString();return h.shared().lock.release(),e}}class R{static call(e){return new Promise(t=>{if(!l.shared().initialized)return v.e("[XRemoteClient : call] The WASM module is not initialized"),t(void 0);try{h.generate().then(s=>{m.shared().add(s,r=>t(l.shared().config.serializer.decodeFunctionReturnValue(r))),l.shared().module.ProxyClient.callFromJavascript(e.data(),r=>{m.shared().execute(s,r)})})}catch(s){return v.e("[XRemoteClient : call] Error: "+C.get(s)),t(void 0)}})}}class y{constructor(e,t){this.name=e,this.value=t}}class x{constructor(e,...t){this.functionName=e,this.params=t}data(){return l.shared().config.serializer.encodeRequest(this.functionName,...this.params)}}class b{constructor(e,t){this.ptr=e,this.size=t}static createFromArrayBuffer(e){const t=e.byteLength,s=l.shared().module._malloc(t);return l.shared().module.HEAPU8.set(e,s),new b(s,t)}static createUint8ArrayFromPtr(e,t){return new Uint8Array(l.shared().module.HEAPU8.buffer,e,t)}static createUint8ClampedArrayFromPtr(e,t){return new Uint8ClampedArray(l.shared().module.HEAPU8.buffer,e,t)}static free(e){l.shared().module._free(e.ptr)}}var se={name:"VueCamera",props:{width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:500},autoplay:{type:Boolean,default:!0},screenshotFormat:{type:String,default:"image/jpeg"},selectFirstDevice:{type:Boolean,default:!0},playsinline:{type:Boolean,default:!0},resolution:{type:Object,default:null,validator:a=>a.height&&a.width}},emits:["xplpc-camera-list","xplpc-camera-not-supported","xplpc-camera-changed","xplpc-camera-stopped","xplpc-camera-video-live","xplpc-camera-started","xplpc-camera-error"],data(){return{source:null,canvas:null,camerasListEmitted:!1,cameraList:[],deviceId:"",visible:!1,ctx:null,cameraInfo:"XPLPC",destWidth:0,destHeight:0}},watch:{deviceId:function(a){this.changeCamera(a)}},beforeUnmount(){this.stop()},methods:{legacyGetUserMediaSupport(){return a=>{let e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;return e?new Promise(function(t,s){e.call(navigator,a,t,s)}):Promise.reject(new Error("[Camera : legacyGetUserMediaSupport] The method getUserMedia is not implemented in this browser"))}},setupMedia(){navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=this.legacyGetUserMediaSupport()),this.testMediaAccess()},loadCameraList(){navigator.mediaDevices.enumerateDevices().then(a=>{for(let e=0;e!==a.length;++e){let t=a[e];t.kind==="videoinput"&&this.cameraList.push(t)}}).then(()=>{this.camerasListEmitted||(this.selectFirstDevice&&this.cameraList.length>0&&this.setDeviceId(this.cameraList[0].deviceId),this.$emit("xplpc-camera-list",this.cameraList),this.camerasListEmitted=!0)}).catch(a=>this.$emit("xplpc-camera-not-supported",a))},changeCamera(a){this.stop(),this.$emit("xplpc-camera-changed",a),this.loadCamera(a)},loadSrcStream(a){"srcObject"in this.$refs.video?this.$refs.video.srcObject=a:this.source=window.HTMLMediaElement.srcObject(a),this.$refs.video.onloadedmetadata=()=>{this.$emit("xplpc-camera-video-live",a)},this.$emit("xplpc-camera-started",a)},stopStreamedVideo(a){let e=a.srcObject;e.getTracks().forEach(t=>{t.stop(),this.$emit("xplpc-camera-stopped",e),this.$refs.video.srcObject=null,this.source=null})},stop(){this.$refs.video&&this.$refs.video.srcObject&&this.stopStreamedVideo(this.$refs.video)},async start(){await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}),this.deviceId||this.loadCameraList(),this.deviceId&&(this.setupMedia(),this.loadCamera(this.deviceId))},pause(){this.$refs.video&&this.$refs.video.srcObject&&this.$refs.video.pause()},resume(){this.$refs.video&&this.$refs.video.srcObject&&this.$refs.video.play()},processImage(){setInterval(async()=>{this.getCanvas();const a=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),e=b.createFromArrayBuffer(a.data);var t=performance.now();const s=new x("sample.image.grayscale.dataview",new y("dataView",e));await R.call(s);var r=performance.now(),p=r-t,u=b.createUint8ClampedArrayFromPtr(e.ptr,e.size);this.ctx.putImageData(new ImageData(u,this.canvas.width,this.canvas.height),0,0);const o=this.$refs.preview;o.src=this.canvas.toDataURL(),b.free(e),this.cameraInfo="Time to process: "+(p/1e3).toFixed(3)+` seconds
Image size: `+e.size/1024+" kb"},16)},testMediaAccess(){let a={video:!0};this.resolution&&(a.video={},a.video.width=this.resolution.width,a.video.height=this.resolution.height),navigator.mediaDevices.getUserMedia(a).then(e=>{e.getTracks().forEach(t=>{t.stop()}),this.loadCameraList()}).catch(e=>this.$emit("xplpc-camera-error",e))},loadCamera(a){let e={video:{deviceId:{exact:a}}};this.resolution&&(e.video.width=this.resolution.width,e.video.height=this.resolution.height),navigator.mediaDevices.getUserMedia(e).then(t=>this.loadSrcStream(t)).catch(t=>this.$emit("xplpc-camera-error",t))},capture(){return this.getCanvas().toDataURL(this.screenshotFormat)},getCanvas(){let a=this.$refs.video;if(!this.ctx){this.destWidth=240,this.destHeight=this.destWidth*a.videoHeight/a.videoWidth,this.destHeight>320&&(this.destHeight=320,this.destWidth=this.destHeight*a.videoWidth/a.videoHeight);let s=this.$refs.canvas;s.width=this.destWidth,s.height=this.destHeight,this.canvas=s,a.width=this.destWidth,a.height=this.destHeight,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0})}const{ctx:e,canvas:t}=this;return e.drawImage(a,0,0,this.destWidth,this.destHeight),t},setDeviceId(a){this.deviceId=a},canPlay(){this.getCanvas(),this.processImage(),this.visible=!0}}};const re={class:"text-center"},ne={class:"camera-container text-center"},ce=["src","autoplay","playsinline"],le={key:0,ref:"preview",class:"camera-image"},oe={key:0,class:"camera-info"},de={ref:"canvas",style:{display:"none"}};function he(a,e){return g(),f("div",re,[i("div",ne,[i("video",{ref:"video",src:a.source,autoplay:a.autoplay,playsinline:a.playsinline,style:{display:"none"},onCanplay:e[0]||(e[0]=(...t)=>a.canPlay&&a.canPlay(...t))},null,40,ce),a.visible?(g(),f("img",le,null,512)):ee("",!0)]),a.visible?(g(),f("div",oe,[i("p",null,U(a.cameraInfo),1)])):ee("",!0),i("canvas",de,null,512)])}var ue=we(se,[["render",he]]);let P,E,q,$,A,I,D,F,S,_,O,H,z,T,j,W,V,B,G,N,X,J,Y;P={class:"container"},E={key:0},q={class:"text-left"},$=i("h4",{id:"pageTitle",class:"my-5 text-center"},"BATTERY LEVEL",-1),A={class:"my-5 text-center"},I={id:"responseMessageForBattery",class:"text-center"},D=i("hr",null,null,-1),F=i("h4",{id:"pageTitle",class:"my-5 text-center"},"LOGIN",-1),S={class:"mb-3"},_=i("label",{for:"fieldUsername",class:"form-label"},"Username",-1),O={class:"mb-3"},H=i("label",{for:"fieldPassword",class:"form-label"},"Password",-1),z={class:"mb-3 form-check"},T=i("label",{class:"form-check-label",for:"fieldRemember"},"Remember",-1),j={class:"my-5 text-center"},W={id:"responseMessageForForm",class:"text-center"},V=i("button",{type:"submit",class:"btn btn-primary"},"Submit",-1),B=i("hr",null,null,-1),G=i("h4",{id:"pageTitle",class:"my-5 text-center"},"CAMERA",-1),N={class:"mb-5 text-center"},X={key:1},J=i("div",{class:"text-center"},[i("p",{class:"my-5"},"Loading...")],-1),Y=[J],ae=ye({__name:"MainPage",setup(a){const e=be(),t=w(null),s=w(null),r=w(!1),p=w(),u="Use account paulo/123456 to success login",o=w(u),K="Press Button To Execute",M=w(K);async function me(n){n.preventDefault(),Q("Calling...");const d=new x("sample.login",new y("username",t.value),new y("password",s.value),new y("remember",r.value));let c=await R.call(d);Q(c?"Response: "+c:"Response: ERROR!")}async function pe(n){n.preventDefault(),Z("Calling...");const d=new x("platform.battery.level",new y("suffix","%"));let c=await ie.call(d);Z(c?"Response: "+c:"Response: ERROR!")}async function ve(n){n.preventDefault(),p.value?.start()}function Q(n){n?o.value=n:o.value="ERROR!"}function Z(n){n?M.value=n:M.value="ERROR!"}function ge(){t.value=null,s.value=null,r.value=!1,o.value=u,M.value=K}return(n,d)=>(g(),f("div",P,[Me(e).isLoaded?(g(),f("div",E,[i("div",q,[$,i("p",A,[i("small",I,U(M.value),1)]),i("div",{class:"form-bt-group text-center mb-5"},[i("button",{type:"button",class:"btn btn-primary",onClick:pe},"Submit")]),D,F,i("form",{onSubmit:me},[i("div",S,[_,L(i("input",{id:"fieldUsername","onUpdate:modelValue":d[0]||(d[0]=c=>t.value=c),type:"text",class:"form-control"},null,512),[[te,t.value]])]),i("div",O,[H,L(i("input",{id:"fieldPassword","onUpdate:modelValue":d[1]||(d[1]=c=>s.value=c),type:"password",class:"form-control"},null,512),[[te,s.value]])]),i("div",z,[L(i("input",{id:"fieldRemember","onUpdate:modelValue":d[2]||(d[2]=c=>r.value=c),type:"checkbox",class:"form-check-input"},null,512),[[xe,r.value]]),T]),i("p",j,[i("small",W,U(o.value),1)]),i("div",{class:"form-bt-group text-center mb-5"},[V,i("button",{type:"button",class:"btn btn-primary",onClick:ge},"Clear")])],32),B,G,i("div",N,[Ce(ue,{ref_key:"camera",ref:p,width:240,height:320},null,512)]),i("div",{class:"form-bt-group text-center mb-5"},[i("button",{type:"button",class:"btn btn-primary",onClick:ve},"Open")])])])):(g(),f("div",X,Y))]))}})});export{Le as __tla,ae as default};
