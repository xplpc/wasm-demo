import{X as h,L as f,a as ve,E as C,_ as ge,o as y,c as b,b as i,d as Z,t as k,e as fe,u as we,r as M,f as ye,w as L,v as ee,g as be,h as Me,__tla as xe}from"./index.89851435.js";let te,Ce=Promise.all([(()=>{try{return xe}catch{}})()]).then(async()=>{class ae{static call(e){return new Promise(a=>{const s=e.data(),r=h.shared().config.serializer.decodeFunctionName(s);if(!r)return f.e("[LocalClient : call] Function name is empty"),a(void 0);const m=ve.shared().find(r);if(m==null)return f.e("[LocalClient : call] Mapping not found for function: "+r),a(void 0);let o;try{o=h.shared().config.serializer.decodeMessage(s)}catch(n){f.e("[LocalClient : call] Error when decode message: "+C.get(n))}if(!o)return f.e("[LocalClient : call] Error when decode message for function: "+r),a(void 0);try{return a(m.target(o))}catch(n){f.e("[LocalClient : call] Error: "+C.get(n))}return a(void 0)})}}class R{constructor(){this._isAcquired=!1,this._acquiredMap=new Map,this.waitingMap=new Map,this.waitingList=[]}acquire(e){if(e){if(!this._acquiredMap.has(e)||!this._acquiredMap.get(e))return this._acquiredMap.set(e,!0),Promise.resolve()}else if(!this._isAcquired)return this._isAcquired=!0,Promise.resolve();return new Promise(a=>{if(e)if(this.waitingMap.has(e)){const s=this.waitingMap.get(e);s&&(s.push(a),this.waitingMap.set(e,s))}else this.waitingMap.set(e,[a]);else this.waitingList.push(a)})}isAcquired(e){return e?this._acquiredMap.has(e)?this._acquiredMap.get(e):!1:this._isAcquired}release(e){if(e){if(!this._acquiredMap.has(e)||!this._acquiredMap.get(e))throw new Error("Please acquire a lock for "+e+" before releasing!!");{const a=this.waitingMap.get(e);if(a&&a.length>0){const s=this.waitingMap.get(e)?.shift();s&&s()}else this.waitingMap.has(e)&&this.waitingMap.delete(e),this._acquiredMap.set(e,!1)}}else if(this._isAcquired)if(this.waitingList.length>0){const a=this.waitingList.shift();a&&a()}else this._isAcquired=!1;else throw new Error("Please acquire a lock before releasing!!")}}class v{constructor(){this.list=new Map,this.lock=new R}static shared(){return v.instance||(v.instance=new v),v.instance}async add(e,a){return await this.lock.acquire(),this.list.set(e,a),this.lock.release()}async execute(e,a){if(await this.lock.acquire(),this.list.has(e)){const s=this.list.get(e);return this.list.delete(e),this.lock.release(),s?.(a)}return this.lock.release()}async count(){await this.lock.acquire();const e=this.list.size;return this.lock.release(),e}}class u{constructor(){this.lock=new R,this.uid=0}static shared(){return u.instance||(u.instance=new u),u.instance}static async generate(){await u.shared().lock.acquire();const e=(++u.shared().uid).toString();return u.shared().lock.release(),e}}class U{static call(e){return new Promise(a=>{if(!h.shared().initialized)return f.e("[XRemoteClient : call] The WASM module is not initialized"),a(void 0);try{u.generate().then(s=>{v.shared().add(s,r=>a(h.shared().config.serializer.decodeFunctionReturnValue(r))),h.shared().module.ProxyClient.callFromJavascript(e.data(),r=>{v.shared().execute(s,r)})})}catch(s){return f.e("[XRemoteClient : call] Error: "+C.get(s)),a(void 0)}})}}class g{constructor(e,a){this.name=e,this.value=a}}class x{constructor(e,...a){this.functionName=e,this.params=a}data(){return h.shared().config.serializer.encodeRequest(this.functionName,...this.params)}}var ie={name:"VueCamera",props:{width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:500},autoplay:{type:Boolean,default:!0},screenshotFormat:{type:String,default:"image/jpeg"},selectFirstDevice:{type:Boolean,default:!0},playsinline:{type:Boolean,default:!0},resolution:{type:Object,default:null,validator:t=>t.height&&t.width}},emits:["xplpc-camera-list","xplpc-camera-not-supported","xplpc-camera-changed","xplpc-camera-stopped","xplpc-camera-video-live","xplpc-camera-started","xplpc-camera-error"],data(){return{source:null,canvas:null,camerasListEmitted:!1,cameraList:[],deviceId:"",visible:!1,ctx:null,cameraInfo:"XPLPC"}},watch:{deviceId:function(t){this.changeCamera(t)}},beforeUnmount(){this.stop()},methods:{legacyGetUserMediaSupport(){return t=>{let e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;return e?new Promise(function(a,s){e.call(navigator,t,a,s)}):Promise.reject(new Error("[Camera : legacyGetUserMediaSupport] The method getUserMedia is not implemented in this browser"))}},setupMedia(){navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=this.legacyGetUserMediaSupport()),this.testMediaAccess()},loadCameraList(){navigator.mediaDevices.enumerateDevices().then(t=>{for(let e=0;e!==t.length;++e){let a=t[e];a.kind==="videoinput"&&this.cameraList.push(a)}}).then(()=>{this.camerasListEmitted||(this.selectFirstDevice&&this.cameraList.length>0&&this.setDeviceId(this.cameraList[0].deviceId),this.$emit("xplpc-camera-list",this.cameraList),this.camerasListEmitted=!0)}).catch(t=>this.$emit("xplpc-camera-not-supported",t))},changeCamera(t){this.stop(),this.$emit("xplpc-camera-changed",t),this.loadCamera(t)},loadSrcStream(t){"srcObject"in this.$refs.video?this.$refs.video.srcObject=t:this.source=window.HTMLMediaElement.srcObject(t),this.$refs.video.onloadedmetadata=()=>{this.$emit("xplpc-camera-video-live",t)},this.$emit("xplpc-camera-started",t)},stopStreamedVideo(t){let e=t.srcObject;e.getTracks().forEach(a=>{a.stop(),this.$emit("xplpc-camera-stopped",e),this.$refs.video.srcObject=null,this.source=null})},stop(){this.$refs.video&&this.$refs.video.srcObject&&this.stopStreamedVideo(this.$refs.video)},async start(){await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}),this.deviceId||this.loadCameraList(),this.deviceId&&(this.setupMedia(),this.loadCamera(this.deviceId))},pause(){this.$refs.video&&this.$refs.video.srcObject&&this.$refs.video.pause()},resume(){this.$refs.video&&this.$refs.video.srcObject&&this.$refs.video.play()},processImage(){setInterval(async()=>{this.getCanvas();const t=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);var e=t.data.length,a=new Uint8Array(t.data),s=h.shared().module._malloc(e);h.shared().module.HEAPU8.set(a,s);var r=performance.now();const m=new x("sample.image.grayscale.pointer",new g("pointer",s),new g("width",this.canvas.width),new g("height",this.canvas.height));await U.call(m);var o=performance.now(),n=o-r,p=new Uint8ClampedArray(h.shared().module.HEAPU8.buffer,s,e);this.ctx.putImageData(new ImageData(p,this.canvas.width,this.canvas.height),0,0);const w=this.$refs.preview;w.src=this.canvas.toDataURL(),h.shared().module._free(s),this.cameraInfo="Time to process: "+(n/1e3).toFixed(3)+` seconds
Image size: `+e/1024+" kb"},16)},testMediaAccess(){let t={video:!0};this.resolution&&(t.video={},t.video.width=this.resolution.width,t.video.height=this.resolution.height),navigator.mediaDevices.getUserMedia(t).then(e=>{e.getTracks().forEach(a=>{a.stop()}),this.loadCameraList()}).catch(e=>this.$emit("xplpc-camera-error",e))},loadCamera(t){let e={video:{deviceId:{exact:t}}};this.resolution&&(e.video.width=this.resolution.width,e.video.height=this.resolution.height),navigator.mediaDevices.getUserMedia(e).then(a=>this.loadSrcStream(a)).catch(a=>this.$emit("xplpc-camera-error",a))},capture(){return this.getCanvas().toDataURL(this.screenshotFormat)},getCanvas(){let t=this.$refs.video;if(!this.ctx){var e=240,a=320,s=Math.max(e/t.videoWidth,a/t.videoHeight),r=t.videoWidth*s,m=t.videoHeight*s;let p=document.createElement("canvas");p.width=r,p.height=m,this.canvas=p,this.ctx=p.getContext("2d",{willReadFrequently:!0})}const{ctx:o,canvas:n}=this;return o.drawImage(t,0,0,n.width,n.height),n},setDeviceId(t){this.deviceId=t},canPlay(){this.getCanvas(),this.processImage(),this.visible=!0}}};const se={class:"text-center"},re={class:"camera-container text-center"},ne=["width","height","src","autoplay","playsinline"],ce={key:0,ref:"preview",class:"camera-image"},le={key:0,class:"camera-info"};function oe(t,e){return y(),b("div",se,[i("div",re,[i("video",{ref:"video",width:t.width,height:t.height,src:t.source,autoplay:t.autoplay,playsinline:t.playsinline,style:{display:"none"},onCanplay:e[0]||(e[0]=(...a)=>t.canPlay&&t.canPlay(...a))},null,40,ne),t.visible?(y(),b("img",ce,null,512)):Z("",!0)]),t.visible?(y(),b("div",le,[i("p",null,k(t.cameraInfo),1)])):Z("",!0)])}var de=ge(ie,[["render",oe]]);let E,q,P,$,I,D,_,A,S,O,F,T,j,z,G,V,B,N,H,X,W,J,Y;E={class:"container"},q={key:0},P={class:"text-left"},$=i("h4",{id:"pageTitle",class:"my-5 text-center"},"BATTERY LEVEL",-1),I={class:"my-5 text-center"},D={id:"responseMessageForBattery",class:"text-center"},_=i("hr",null,null,-1),A=i("h4",{id:"pageTitle",class:"my-5 text-center"},"LOGIN",-1),S={class:"mb-3"},O=i("label",{for:"fieldUsername",class:"form-label"},"Username",-1),F={class:"mb-3"},T=i("label",{for:"fieldPassword",class:"form-label"},"Password",-1),j={class:"mb-3 form-check"},z=i("label",{class:"form-check-label",for:"fieldRemember"},"Remember",-1),G={class:"my-5 text-center"},V={id:"responseMessageForForm",class:"text-center"},B=i("button",{type:"submit",class:"btn btn-primary"},"Submit",-1),N=i("hr",null,null,-1),H=i("h4",{id:"pageTitle",class:"my-5 text-center"},"CAMERA",-1),X={class:"mb-5 text-center"},W={key:1},J=i("div",{class:"text-center"},[i("p",{class:"my-5"},"Loading...")],-1),Y=[J],te=fe({__name:"MainPage",setup(t){const e=we(),a=M(null),s=M(null),r=M(!1),m=M(),o="Use account paulo/123456 to success login",n=M(o),p="Press Button To Execute",w=M(p);async function he(c){c.preventDefault(),K("Calling...");const d=new x("sample.login",new g("username",a.value),new g("password",s.value),new g("remember",r.value));let l=await U.call(d);K(l?"Response: "+l:"Response: ERROR!")}async function ue(c){c.preventDefault(),Q("Calling...");const d=new x("platform.battery.level",new g("suffix","%"));let l=await ae.call(d);Q(l?"Response: "+l:"Response: ERROR!")}async function me(c){c.preventDefault(),m.value?.start()}function K(c){c?n.value=c:n.value="ERROR!"}function Q(c){c?w.value=c:w.value="ERROR!"}function pe(){a.value=null,s.value=null,r.value=!1,n.value=o,w.value=p}return(c,d)=>(y(),b("div",E,[ye(e).isLoaded?(y(),b("div",q,[i("div",P,[$,i("p",I,[i("small",D,k(w.value),1)]),i("div",{class:"form-bt-group text-center mb-5"},[i("button",{type:"button",class:"btn btn-primary",onClick:ue},"Submit")]),_,A,i("form",{onSubmit:he},[i("div",S,[O,L(i("input",{id:"fieldUsername","onUpdate:modelValue":d[0]||(d[0]=l=>a.value=l),type:"text",class:"form-control"},null,512),[[ee,a.value]])]),i("div",F,[T,L(i("input",{id:"fieldPassword","onUpdate:modelValue":d[1]||(d[1]=l=>s.value=l),type:"password",class:"form-control"},null,512),[[ee,s.value]])]),i("div",j,[L(i("input",{id:"fieldRemember","onUpdate:modelValue":d[2]||(d[2]=l=>r.value=l),type:"checkbox",class:"form-check-input"},null,512),[[be,r.value]]),z]),i("p",G,[i("small",V,k(n.value),1)]),i("div",{class:"form-bt-group text-center mb-5"},[B,i("button",{type:"button",class:"btn btn-primary",onClick:pe},"Clear")])],32),N,H,i("div",X,[Me(de,{ref_key:"camera",ref:m,width:240,height:320},null,512)]),i("div",{class:"form-bt-group text-center mb-5"},[i("button",{type:"button",class:"btn btn-primary",onClick:me},"Open")])])])):(y(),b("div",W,Y))]))}})});export{Ce as __tla,te as default};
